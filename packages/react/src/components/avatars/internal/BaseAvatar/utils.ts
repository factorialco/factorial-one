import { BadgeProps } from "@/experimental/Information/Badge"
import {
  internalAvatarColors as AvatarColors,
  Avatar as AvatarComponent,
} from "@/ui/Avatar"
import { type ComponentProps } from "react"
import { F0AvatarModuleProps } from "../../F0AvatarModule"
import { AvatarSize } from "./types"

type ShadAvatarProps = ComponentProps<typeof AvatarComponent>

export function getInitials(
  name: string | string[],
  size: AvatarSize = "md"
): string {
  const nameArray = Array.isArray(name) ? name : [name]
  const isSmall = ["xs", "sm"].includes(size)
  if (isSmall) {
    return (nameArray[0][0] ?? "").toUpperCase()
  }
  if (!Array.isArray(name)) {
    return name.slice(0, 2).toUpperCase()
  }

  return nameArray
    .slice(0, 2)
    .map((name) => name[0])
    .join("")
    .toUpperCase()
}

export function getAvatarColor(text: string): ShadAvatarProps["color"] {
  let hash = 0

  for (let i = 0; i < text.length; i++) {
    hash = text.charCodeAt(i) + ((hash << 5) - hash)
    hash = hash & hash
  }

  const index =
    ((hash % AvatarColors.length) + AvatarColors.length) % AvatarColors.length

  return AvatarColors[index]
}

type MaskVariant = "default" | "module"
type MaskSize = AvatarSize
type MaskType = "base" | "rounded"

type MaskPaths = {
  [K in MaskType]: {
    [S in MaskSize]: {
      [V in MaskVariant]: string
    }
  }
}

export const getMask = {
  base: {
    "2xl": {
      default:
        "path('M72 0H0V72H52.202C49.6089 69.459 48 65.9174 48 62C48 54.268 54.268 48 62 48C65.9174 48 69.459 49.6089 72 52.202V0ZM72 71.798C71.9333 71.866 71.866 71.9333 71.798 72H72V71.798Z')",
      module:
        "path('M46.4004 0C55.3609 3.65342e-10 59.8411 0.00029099 63.2637 1.74414C66.2743 3.27811 68.7219 5.72573 70.2559 8.73633C71.9997 12.1589 72 16.6391 72 25.5996V46.4004C72 47.7896 71.9987 49.0712 71.9922 50.2578C69.7863 48.658 66.5508 48 62 48C51.5 48 48 51.5 48 62C48 66.5508 48.658 69.7863 50.2578 71.9922C49.0712 71.9987 47.7896 72 46.4004 72H25.5996C16.6391 72 12.1589 71.9997 8.73633 70.2559C5.72573 68.7219 3.27811 66.2743 1.74414 63.2637C0.000291109 59.8411 3.69382e-10 55.3609 0 46.4004V25.5996C3.65342e-10 16.6391 0.00029099 12.1589 1.74414 8.73633C3.27811 5.72573 5.72573 3.27811 8.73633 1.74414C12.1589 0.000291109 16.6391 3.69382e-10 25.5996 0H46.4004Z')",
    },
    xl: {
      default:
        "path('M56 0H0V56H39.0556C37.1554 53.877 36 51.0734 36 48C36 41.3726 41.3726 36 48 36C51.0734 36 53.877 37.1554 56 39.0556V0Z')",
      module:
        "path('M30.4004 0C39.3609 3.71637e-10 43.8411 0.000291228 47.2637 1.74414C50.2743 3.27811 52.7219 5.72573 54.2559 8.73633C55.9997 12.1589 56 16.6391 56 25.5996V30.4004C56 33.1737 55.9999 35.5178 55.9482 37.5342C54.087 36.4528 51.4963 36 48 36C39 36 36 39 36 48C36 51.4963 36.4528 54.087 37.5342 55.9482C35.5178 55.9999 33.1737 56 30.4004 56H25.5996C16.6391 56 12.1589 55.9997 8.73633 54.2559C5.72573 52.7219 3.27811 50.2743 1.74414 47.2637C0.000291109 43.8411 3.68483e-10 39.3609 0 30.4004V25.5996C3.71637e-10 16.6391 0.000291228 12.1589 1.74414 8.73633C3.27811 5.72573 5.72573 3.27811 8.73633 1.74414C12.1589 0.000291109 16.6391 3.68483e-10 25.5996 0H30.4004Z')",
    },
    lg: {
      default:
        "path('M20.7998 0C27.5204 0 30.8813 -0.00030458 33.4482 1.30762C35.7061 2.45808 37.5419 4.29394 38.6924 6.55176C40.0003 9.1187 40 12.4796 40 19.2002V20.7998C40 24.9742 39.999 27.8522 39.6855 30.0488C38.615 29.3845 37.3526 29 36 29C32.134 29 29 32.134 29 36C29 37.3526 29.3845 38.615 30.0488 39.6855C27.8522 39.999 24.9742 40 20.7998 40H19.2002C12.4796 40 9.1187 40.0003 6.55176 38.6924C4.29394 37.5419 2.45808 35.7061 1.30762 33.4482C-0.00030458 30.8813 0 27.5204 0 20.7998V19.2002C0 12.4796 -0.00030458 9.1187 1.30762 6.55176C2.45808 4.29394 4.29394 2.45808 6.55176 1.30762C9.1187 -0.00030458 12.4796 0 19.2002 0H20.7998Z')",
      module:
        "path('M20 6.35055e-10C25.5858 6.35055e-10 28.3788 -0.0004614 30.624 0.785156C34.6455 2.19233 37.8077 5.35452 39.2148 9.37598C40.0005 11.6212 40 14.4142 40 20C40 24.6415 39.9967 27.3539 39.5459 29.4268C38.5999 29.1317 37.4301 29 36 29C30.75 29 29 30.75 29 36C29 37.4301 29.1317 38.5999 29.4268 39.5459C27.3539 39.9967 24.6415 40 20 40C14.4142 40 11.6212 40.0005 9.37598 39.2148C5.35452 37.8077 2.19233 34.6455 0.785156 30.624C-0.0004614 28.3788 6.35204e-10 25.5858 6.35204e-10 20C6.35204e-10 14.4142 -0.0004614 11.6212 0.785156 9.37598C2.19233 5.35452 5.35452 2.19233 9.37598 0.785156C11.6212 -0.0004614 14.4142 6.35055e-10 20 6.35055e-10Z')",
    },
    md: {
      default:
        "path('M32 0H0V32H22.2547C21.4638 30.8662 21 29.4872 21 28C21 24.134 24.134 21 28 21C29.4872 21 30.8662 21.4638 32 22.2547V0Z')",
      module:
        "path('M16 0C21.6005 0 24.4009 -9.10759e-05 26.54 1.08984C28.4216 2.04857 29.9514 3.5784 30.9102 5.45996C32.0001 7.59908 32 10.3995 32 16C32 18.2626 31.9977 20.0681 31.9258 21.5576C30.9188 21.169 29.6278 21 28 21C22.75 21 21 22.75 21 28C21 29.6278 21.169 30.9188 21.5576 31.9258C20.0681 31.9977 18.2626 32 16 32C10.3995 32 7.59908 32.0001 5.45996 30.9102C3.5784 29.9514 2.04857 28.4216 1.08984 26.54C-9.10759e-05 24.4009 0 21.6005 0 16C0 10.3995 -9.10759e-05 7.59908 1.08984 5.45996C2.04857 3.5784 3.5784 2.04857 5.45996 1.08984C7.59908 -9.10759e-05 10.3995 0 16 0Z')",
    },
    sm: {
      default:
        "path('M24 0H0V24H14.2547C13.4638 22.8662 13 21.4872 13 20C13 16.134 16.134 13 20 13C21.4872 13 22.8662 13.4638 24 14.2547V0Z')",
      module:
        "path('M12 0C15.7275 0 17.5914 0.000411272 19.0615 0.609375C21.0216 1.42132 22.5787 2.97841 23.3906 4.93848C23.9996 6.40865 24 8.27247 24 12C24 12.5706 23.9983 13.0974 23.9961 13.5859C22.9791 13.1775 21.666 13 20 13C14.75 13 13 14.75 13 20C13 21.666 13.1775 22.9791 13.5859 23.9961C13.0974 23.9983 12.5706 24 12 24C8.27247 24 6.40865 23.9996 4.93848 23.3906C2.97841 22.5787 1.42132 21.0216 0.609375 19.0615C0.000411272 17.5914 0 15.7275 0 12C0 8.27247 0.000411272 6.40865 0.609375 4.93848C1.42132 2.97841 2.97841 1.42132 4.93848 0.609375C6.40865 0.000411272 8.27247 0 12 0Z')",
    },
    xs: {
      default:
        "path('M20 0H0V20H10.2547C9.46381 18.8662 9 17.4872 9 16C9 12.134 12.134 9 16 9C17.4872 9 18.8662 9.46381 20 10.2547V0Z')",
      module:
        "path('M10.4004 0C13.7603 9.83795e-10 15.4402 0.00041759 16.7236 0.654297C17.8526 1.22954 18.7705 2.14739 19.3457 3.27637C19.9996 4.55977 20 6.23965 20 9.59961V10.4004C20 10.7343 19.9997 11.0516 19.999 11.3535C19.1953 11.1094 18.2055 11 17 11C12.5 11 11 12.5 11 17C11 18.2055 11.1094 19.1953 11.3535 19.999C11.0516 19.9997 10.7343 20 10.4004 20H9.59961C6.23965 20 4.55977 19.9996 3.27637 19.3457C2.14739 18.7705 1.22954 17.8526 0.654297 16.7236C0.00041759 15.4402 9.83795e-10 13.7603 0 10.4004V9.59961C9.83795e-10 6.23965 0.00041759 4.55977 0.654297 3.27637C1.22954 2.14739 2.14739 1.22954 3.27637 0.654297C4.55977 0.00041759 6.23965 9.83795e-10 9.59961 0H10.4004Z')",
    },
  },
  rounded: {
    "2xl": {
      default:
        "path('M69.1842 49.9814C70.9975 45.6828 72 40.9585 72 36C72 16.1177 55.8823 0 36 0C16.1177 0 0 16.1177 0 36C0 55.8823 16.1177 72 36 72C40.9585 72 45.6828 70.9975 49.9814 69.1842C48.7232 67.0839 48 64.6264 48 62C48 54.268 54.268 48 62 48C64.6264 48 67.0839 48.7232 69.1842 49.9814Z')",
      module:
        "path('M36 0C55.8823 0 72 16.1177 72 36C72 40.588 71.139 44.9745 69.5742 49.0098C67.6022 48.3059 65.1076 48 62 48C51.5 48 48 51.5 48 62C48 65.1077 48.3067 67.6022 49.0107 69.5742C44.9752 71.1392 40.5883 72 36 72C16.1177 72 0 55.8823 0 36C0 16.1177 16.1177 0 36 0Z')",
    },
    xl: {
      default:
        "path('M54.2534 37.7562C55.3828 34.7182 56 31.4312 56 28C56 12.536 43.464 0 28 0C12.536 0 0 12.536 0 28C0 43.464 12.536 56 28 56C31.4312 56 34.7182 55.3828 37.7562 54.2534C36.6421 52.4324 36 50.2912 36 48C36 41.3726 41.3726 36 48 36C50.2912 36 52.4324 36.6421 54.2534 37.7562Z')",
      module:
        "path('M28 0C43.464 0 56 12.536 56 28C56 31.108 55.4924 34.0972 54.5576 36.8906C52.8571 36.2704 50.6984 36 48 36C39 36 36 39 36 48C36 50.6984 36.2704 52.8571 36.8906 54.5576C34.0972 55.4924 31.108 56 28 56C12.536 56 0 43.464 0 28C0 12.536 12.536 0 28 0Z')",
    },
    lg: {
      default:
        "path('M20 0C31.0457 0 40 8.9543 40 20C40 23.326 39.1863 26.4613 37.75 29.2207C37.1907 29.0767 36.6043 29 36 29C32.134 29 29 32.134 29 36C29 36.6043 29.0767 37.1907 29.2207 37.75C26.4613 39.1863 23.326 40 20 40C8.9543 40 0 31.0457 0 20C0 8.9543 8.9543 0 20 0Z')",
      module:
        "path('M20 0C31.0457 0 40 8.9543 40 20C40 23.2721 39.2135 26.3603 37.8203 29.0869C37.2667 29.0279 36.6611 29 36 29C30.75 29 29 30.75 29 36C29 36.6611 29.0279 37.2667 29.0869 37.8203C26.3603 39.2135 23.2721 40 20 40C8.9543 40 0 31.0457 0 20C0 8.9543 8.9543 0 20 0Z')",
    },
    md: {
      default:
        "path('M30.9702 21.6596C31.6358 19.9001 32 17.9926 32 16C32 7.16344 24.8366 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32C17.9926 32 19.9001 31.6358 21.6596 30.9702C21.2365 30.0686 21 29.0619 21 28C21 24.134 24.134 21 28 21C29.0619 21 30.0686 21.2365 30.9702 21.6596Z')",
      module:
        "path('M16 0C24.8366 0 32 7.16344 32 16C32 17.8588 31.6815 19.6431 31.0986 21.3027C30.238 21.0945 29.2125 21 28 21C22.75 21 21 22.75 21 28C21 29.2125 21.0945 30.238 21.3027 31.0986C19.6431 31.6815 17.8588 32 16 32C7.16344 32 0 24.8366 0 16C0 7.16344 7.16344 0 16 0Z')",
    },
    sm: {
      default:
        "path('M23.8119 14.128C23.9355 13.4373 24 12.7262 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24C12.7262 24 13.4373 23.9355 14.128 23.8119C13.4145 22.7151 13 21.406 13 20C13 16.134 16.134 13 20 13C21.406 13 22.7151 13.4145 23.8119 14.128Z')",
      module:
        "path('M12 0C18.6274 0 24 5.37258 24 12C24 12.5245 23.9657 13.0411 23.9004 13.5479C22.8971 13.1662 21.6141 13 20 13C14.75 13 13 14.75 13 20C13 21.6141 13.1662 22.8971 13.5479 23.9004C13.0411 23.9657 12.5245 24 12 24C5.37258 24 0 18.6274 0 12C0 5.37258 5.37258 0 12 0Z')",
    },
    xs: {
      default:
        "path('M10 0C15.5228 0 20 4.47715 20 10C20 10.5862 19.9464 11.1602 19.8496 11.7188C19.0019 11.2604 18.0314 11 17 11C13.6863 11 11 13.6863 11 17C11 18.0314 11.2604 19.0019 11.7188 19.8496C11.1602 19.9464 10.5862 20 10 20C4.47715 20 0 15.5228 0 10C0 4.47715 4.47715 0 10 0Z')",
      module:
        "path('M10 0C15.5228 0 20 4.47715 20 10C20 10.4498 19.9667 10.8921 19.9092 11.3262C19.1218 11.1008 18.1609 11 17 11C12.5 11 11 12.5 11 17C11 18.1609 11.1008 19.1218 11.3262 19.9092C10.8921 19.9667 10.4498 20 10 20C4.47715 20 0 15.5228 0 10C0 4.47715 4.47715 0 10 0Z')",
    },
  },
  get: (
    type: MaskType = "base",
    size: MaskSize = "md",
    variant: MaskVariant = "default"
  ): string => {
    return getMask[type][size][variant]
  },
} as const satisfies {
  base: MaskPaths["base"]
  rounded: MaskPaths["rounded"]
  get: (type: MaskType, size: MaskSize, variant: MaskVariant) => string
}

export const getBadgeSize = (
  size: AvatarSize
): BadgeProps["size"] | undefined => {
  const sizeMap: Partial<
    Record<Exclude<AvatarSize, undefined>, BadgeProps["size"]>
  > = {
    "2xl": "lg",
    xl: "md",
    lg: "sm",
    sm: "sm",
    xs: "xs",
  } as const

  return size && sizeMap[size] ? (sizeMap[size] ?? sizeMap.sm) : sizeMap.sm
}

export const getAvatarSize = (
  size: AvatarSize
): F0AvatarModuleProps["size"] => {
  const sizeMap: Partial<
    Record<Exclude<AvatarSize, undefined>, F0AvatarModuleProps["size"]>
  > = {
    "2xl": "md",
    xl: "sm",
    lg: "xs",
    sm: "xs",
    xs: "xxs",
  } as const

  return size && sizeMap[size] ? (sizeMap[size] ?? sizeMap.sm) : sizeMap.sm
}
